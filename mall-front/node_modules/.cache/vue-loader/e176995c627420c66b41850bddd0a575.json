{"remainingRequest":"F:\\developer\\mall_sys\\mall-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\developer\\mall_sys\\mall-front\\src\\pages\\orderPay.vue?vue&type=script&lang=js","dependencies":[{"path":"F:\\developer\\mall_sys\\mall-front\\src\\pages\\orderPay.vue","mtime":1698657716429},{"path":"F:\\developer\\mall_sys\\mall-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\developer\\mall_sys\\mall-front\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"F:\\developer\\mall_sys\\mall-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\developer\\mall_sys\\mall-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBRUkNvZGUgZnJvbSAncXJjb2RlJwppbXBvcnQgT3JkZXJIZWFkZXIgZnJvbSAnLi8uLi9jb21wb25lbnRzL09yZGVySGVhZGVyJwppbXBvcnQgU2NhblBheUNvZGUgZnJvbSAnLi8uLi9jb21wb25lbnRzL1NjYW5QYXlDb2RlJwppbXBvcnQgTW9kYWwgZnJvbSAnLi8uLi9jb21wb25lbnRzL01vZGFsJwppbXBvcnQgUXMgZnJvbSAncXMnCmV4cG9ydCBkZWZhdWx0ewogIG5hbWU6J29yZGVyLXBheScsCiAgZGF0YSgpewogICAgcmV0dXJuIHsKICAgICAgb3JkZXJJZDp0aGlzLiRyb3V0ZS5xdWVyeS5vcmRlcklkLAogICAgICBhZGRyZXNzSW5mbzonJywvL+aUtui0p+S6uuWcsOWdgAogICAgICBvcmRlckRldGFpbDpbXSwvL+iuouWNleivpuaDhe+8jOWMheWQq+WVhuWTgeWIl+ihqAogICAgICBzaG93RGV0YWlsOmZhbHNlLC8v5piv5ZCm5pi+56S66K6i5Y2V6K+m5oOFCiAgICAgIHBheVR5cGU6JycsLy/mlK/ku5jnsbvlnosKICAgICAgc2hvd1BheTpmYWxzZSwvL+aYr+WQpuaYvuekuuW+ruS/oeaUr+S7mOW8ueahhgogICAgICBwYXlJbWc6JycsLy/lvq7kv6HmlK/ku5jnmoTkuoznu7TnoIHlnLDlnYAKICAgICAgc2hvd1BheU1vZGFsOmZhbHNlLC8v5piv5ZCm5pi+56S65LqM5qyh5pSv5LuY56Gu6K6k5by55qGGCiAgICAgIHBheW1lbnQ6MCwvL+iuouWNleaAu+mHkeminQogICAgICBUOicnLC8v5a6a5pe25ZmoSUQKICAgICAgcGF5SW1hZ2VRcjonJywgCiAgICAgIG9yZGVyU246JycsCiAgICAgIG9yZGVyT3ZlcnRpbWU6JycsCiAgICB9CiAgfSwKICBjb21wb25lbnRzOnsKICAgIE9yZGVySGVhZGVyLAogICAgU2NhblBheUNvZGUsCiAgICBNb2RhbAogIH0sCiAgbW91bnRlZCgpewogICAgdGhpcy5nZXRPcmRlckRldGFpbCgpOwogIH0sCiAgbWV0aG9kczp7CiAgICBnZXRPcmRlckRldGFpbCgpewogICAgICB0aGlzLmF4aW9zLmdldChgL29yZGVyL29yZGVyRGV0YWlsP29yZGVySWQ9JHt0aGlzLm9yZGVySWR9YCkudGhlbigocmVzKT0+ewogICAgICAgICB0aGlzLm9yZGVyRGV0YWlsPXJlcy5vcmRlckl0ZW1MaXN0OyAgLy/orqLljZXllYblk4Hor6bmg4UKICAgICAgICAgdGhpcy5hZGRyZXNzSW5mbz1yZXMucmVjZWl2ZXJQcm92aW5jZStyZXMucmVjZWl2ZXJDaXR5K3Jlcy5yZWNlaXZlclJlZ2lvbityZXMucmVjZWl2ZXJEZXRhaWxBZGRyZXNzOwogICAgICAgICB0aGlzLnBheW1lbnQ9cmVzLnBheUFtb3VudDsKICAgICAgICAgdGhpcy5vcmRlclNuPXJlcy5vcmRlclNuOwogICAgICAgICB0aGlzLm9yZGVyT3ZlcnRpbWU9cmVzLm5vcm1hbE9yZGVyT3ZlcnRpbWU7CgogICAgICB9KSAKICAgIH0sCiAgICBwYXlTdWJtaXQocGF5VHlwZSl7CiAgICAgIHRoaXMucGF5VHlwZT1wYXlUeXBlOwogICAgICB0aGlzLnNob3dQYXkgPSAhdGhpcy5zaG93UGF5OwogICAgICAvLyDmlK/ku5jlrp0KICAgICAgaWYocGF5VHlwZSA9PSAxKXsgCiAgICAgICAgICB0aGlzLmF4aW9zLnBvc3QoJy9vcmRlci90cmFkZVFyQ29kZScsUXMuc3RyaW5naWZ5KHsKICAgICAgICAgIG9yZGVySWQ6dGhpcy5vcmRlcklkLAogICAgICAgICAgcGF5VHlwZToxCiAgICAgICAgfSkse2hlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9fSkudGhlbigocmVzKT0+ewogICAgICAgIHRoaXMucGF5SW1hZ2VRcj0naHR0cDovL2xvY2FsaG9zdDo4ODg4JytyZXM7CiAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKHJlcyk7CiAgICAgICAgfSkKICAgICAgfWVsc2V7CiAgICAgICAgLy8g5b6u5L+hCiAgICAgICAgdGhpcy5heGlvcy5wb3N0KCcvcGF5Jyx7CiAgICAgICAgICBvcmRlcklkOnRoaXMub3JkZXJJZCwKICAgICAgICAgIG9yZGVyTmFtZTon5ZWG5Z+O5Z+656GA54mIJywKICAgICAgICAgIGFtb3VudDowLjAxLC8v5Y2V5L2N5YWDCiAgICAgICAgICBwYXlUeXBlOjIgLy8x5pSv5LuY5a6d77yMMuW+ruS/oQogICAgICAgIH0pLnRoZW4oKHJlcyk9PnsKICAgICAgICAgIFFSQ29kZS50b0RhdGFVUkwocmVzLmNvbnRlbnQpCiAgICAgICAgICAudGhlbih1cmwgPT4gewogICAgICAgICAgICB0aGlzLnNob3dQYXkgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnBheUltZyA9IHVybDsKICAgICAgICAgICAgdGhpcy5sb29wT3JkZXJTdGF0ZSgpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+W+ruS/oeS6jOe7tOeggeeUn+aIkOWksei0pe+8jOivt+eojeWQjumHjeivlScpOwogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9CiAgICB9LAogICAgLy8g5YWz6Zet5b6u5L+h5by55qGGCiAgICBjbG9zZVBheU1vZGFsKCl7CiAgICAgIHRoaXMuc2hvd1BheSA9IGZhbHNlOwogICAgICB0aGlzLnNob3dQYXlNb2RhbCA9IHRydWU7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5UKTsKICAgIH0sCiAgICAvLyDova7or6LlvZPliY3orqLljZXmlK/ku5jnirbmgIEKICAgIGxvb3BPcmRlclN0YXRlKCl7CiAgICAgIHRoaXMuVCA9IHNldEludGVydmFsKCgpPT57CiAgICAgICAgdGhpcy5heGlvcy5nZXQoYC9vcmRlcnMvJHt0aGlzLm9yZGVySWR9YCkudGhlbigocmVzKT0+ewogICAgICAgICAgaWYocmVzLnN0YXR1cyA9PSAyMCl7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5UKTsKICAgICAgICAgICAgdGhpcy5nb09yZGVyTGlzdCgpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0sMTAwMCk7CiAgICB9LAogICAgZ29PcmRlckxpc3QoKXsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9vcmRlci9saXN0Jyk7CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["orderPay.vue"],"names":[],"mappings":";AAgFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"orderPay.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  <div class=\"order-pay\">\n    <order-header title=\"订单支付\">\n      <template v-slot:tip>\n        <span>请谨防钓鱼链接或诈骗电话，了解更多</span>\n      </template>\n    </order-header>\n    <div class=\"wrapper\">\n      <div class=\"container\">\n        <div class=\"order-wrap\">\n          <div class=\"item-order\">\n            <div class=\"icon-succ\"></div>\n            <div class=\"order-info\">\n              <h2>订单提交成功！去付款咯～</h2>\n              <p>请在<span>{{orderOvertime}}分</span>内完成支付, 超时后将取消订单</p>\n              <p>收货信息：{{addressInfo}}</p>\n            </div>\n            <div class=\"order-total\">\n              <p>应付总额：<span>{{payment}}</span>元</p>\n              <p>订单详情<em class=\"icon-down\" :class=\"{'up':showDetail}\" @click=\"showDetail=!showDetail\"></em></p>\n            </div>\n          </div>\n          <div class=\"item-detail\" v-if=\"showDetail\">\n            <div class=\"item\">\n              <div class=\"detail-title\">订单号：</div>\n              <div class=\"detail-info theme-color\">{{orderSn}}</div>\n            </div>\n            <div class=\"item\">\n              <div class=\"detail-title\">收货信息：</div>\n              <div class=\"detail-info\">{{addressInfo}}</div>\n            </div>\n            <div class=\"item good\">\n              <div class=\"detail-title\">商品名称：</div>\n              <div class=\"detail-info\">\n                <ul>\n                  <li v-for=\"(item,index) in orderDetail\" :key=\"index\">\n                    <img v-lazy=\"item.productPic\"/>{{item.productName}}\n                  </li>\n                </ul>\n              </div>\n            </div>\n            <!-- <div class=\"item\">\n              <div class=\"detail-title\">发票信息：</div>\n              <div class=\"detail-info\">电子发票 个人</div>\n            </div> -->\n          </div>\n        </div>\n        <div class=\"item-pay\">\n          <h3>选择以下支付方式付款</h3>\n          <div class=\"pay-way\">\n            <p>支付平台</p>\n            <div class=\"pay pay-ali\" @click=\"paySubmit(1)\" :class=\"{'checked':payType==1}\"></div>\n            <div class=\"erweima\">\n              <img src=\"/imgs/erweima.png\" style=\"width: 25%; height: 25%;\">\n            </div>\n            <div class=\"pay pay-wechat\" :class=\"{'checked':payType==2}\" ></div>\n          </div>\n           <div class=\"pay-way\"  v-if=\"showPay && payType==1\" >\n              <img  :src=\"payImageQr\"/>\n            </div>\n        </div>\n      </div>\n    </div>\n    <scan-pay-code v-if=\"showPay && payType==2\" @close=\"closePayModal\" :img=\"payImg\"></scan-pay-code>\n    <modal\n      title=\"支付确认\"\n      btnType=\"3\"\n      :showModal=\"showPayModal\"\n      sureText=\"查看订单\"\n      cancelText=\"未支付\"\n      @cancel=\"showPayModal=false\"\n      @submit=\"goOrderList\"\n    >\n      <template v-slot:body>\n        <p>您确认是否完成支付？</p>\n      </template>\n    </modal>\n  </div>\n</template>\n<script>\nimport QRCode from 'qrcode'\nimport OrderHeader from './../components/OrderHeader'\nimport ScanPayCode from './../components/ScanPayCode'\nimport Modal from './../components/Modal'\nimport Qs from 'qs'\nexport default{\n  name:'order-pay',\n  data(){\n    return {\n      orderId:this.$route.query.orderId,\n      addressInfo:'',//收货人地址\n      orderDetail:[],//订单详情，包含商品列表\n      showDetail:false,//是否显示订单详情\n      payType:'',//支付类型\n      showPay:false,//是否显示微信支付弹框\n      payImg:'',//微信支付的二维码地址\n      showPayModal:false,//是否显示二次支付确认弹框\n      payment:0,//订单总金额\n      T:'',//定时器ID\n      payImageQr:'', \n      orderSn:'',\n      orderOvertime:'',\n    }\n  },\n  components:{\n    OrderHeader,\n    ScanPayCode,\n    Modal\n  },\n  mounted(){\n    this.getOrderDetail();\n  },\n  methods:{\n    getOrderDetail(){\n      this.axios.get(`/order/orderDetail?orderId=${this.orderId}`).then((res)=>{\n         this.orderDetail=res.orderItemList;  //订单商品详情\n         this.addressInfo=res.receiverProvince+res.receiverCity+res.receiverRegion+res.receiverDetailAddress;\n         this.payment=res.payAmount;\n         this.orderSn=res.orderSn;\n         this.orderOvertime=res.normalOrderOvertime;\n\n      }) \n    },\n    paySubmit(payType){\n      this.payType=payType;\n      this.showPay = !this.showPay;\n      // 支付宝\n      if(payType == 1){ \n          this.axios.post('/order/tradeQrCode',Qs.stringify({\n          orderId:this.orderId,\n          payType:1\n        }),{headers: {'Content-Type': 'application/x-www-form-urlencoded'}}).then((res)=>{\n        this.payImageQr='http://localhost:8888'+res;\n        window.console.log(res);\n        })\n      }else{\n        // 微信\n        this.axios.post('/pay',{\n          orderId:this.orderId,\n          orderName:'商城基础版',\n          amount:0.01,//单位元\n          payType:2 //1支付宝，2微信\n        }).then((res)=>{\n          QRCode.toDataURL(res.content)\n          .then(url => {\n            this.showPay = true;\n            this.payImg = url;\n            this.loopOrderState();\n          })\n          .catch(() => {\n            this.$message.error('微信二维码生成失败，请稍后重试');\n          })\n        })\n      }\n    },\n    // 关闭微信弹框\n    closePayModal(){\n      this.showPay = false;\n      this.showPayModal = true;\n      clearInterval(this.T);\n    },\n    // 轮询当前订单支付状态\n    loopOrderState(){\n      this.T = setInterval(()=>{\n        this.axios.get(`/orders/${this.orderId}`).then((res)=>{\n          if(res.status == 20){\n            clearInterval(this.T);\n            this.goOrderList();\n          }\n        })\n      },1000);\n    },\n    goOrderList(){\n      this.$router.push('/order/list');\n    }\n  }\n}\n</script>\n<style lang=\"scss\">\n  .order-pay{\n    .wrapper{\n      background-color:#F5F5F5;\n      padding-top:30px;\n      padding-bottom:61px;\n      .order-wrap{\n        padding: 62px 50px;\n        background-color: #fff;\n        font-size:14px;\n        margin-bottom:30px;\n        .item-order{\n          display: flex;\n          align-items: center;\n          .icon-succ{\n            width: 90px;\n            height: 90px;\n            border-radius: 50%;\n            background:url('/imgs/icon-gou.png') #80c58a no-repeat center;\n            background-size:60px;\n            margin-right:40px;\n          }\n          .order-info{\n            margin-right: 248px;\n            h2{\n              font-size:24px;\n              color:#333333;\n              margin-bottom:20px;\n            }\n            p{\n              color:#666666;\n              span{\n                color:#FF6700;\n              }\n            }\n          }\n          .order-total{\n            &>p:first-child{\n              margin-bottom:30px;\n            }\n            span{\n              font-size:28px;\n              color:#FF6700;\n            }\n            .icon-down{\n              display:inline-block;\n              width:14px;\n              height:10px;\n              background:url('/imgs/icon-down.png') no-repeat center;\n              background-size:contain;\n              margin-left:9px;\n              transition:all .5s;\n              cursor:pointer;\n              &.up{\n                transform: rotate(180deg);\n              }\n            }\n            .icon-up{\n              transform: rotate(180deg);\n            }\n          }\n        }\n        .item-detail{\n          border-top: 1px solid #D7D7D7;\n          padding-top: 47px;\n          padding-left: 130px;\n          font-size: 14px;\n          margin-top: 45px;\n          .item{\n            margin-bottom:19px;\n            .detail-title{\n              float:left;\n              width:100px;\n            }\n            .detail-info{\n              display:inline-block;\n              img{\n                width: 30px;\n                vertical-align: middle;\n              }\n            }\n          }\n        }\n      }\n      .item-pay{\n        padding:26px 50px 72px;\n        background-color:#ffffff;\n        color: #333333;\n        h3{\n          font-size: 20px;\n          font-weight: 200;\n          color: #333333;\n          padding-bottom: 24px;\n          border-bottom: 1px solid #D7D7D7;\n          margin-bottom: 26px;\n        }\n        // .erweima{\n        //   .img{\n        //   width:50px;\n        //   height:50px;\n        //   }\n        // }\n        .pay-way{\n          font-size:18px;\n          .pay{\n            display:inline-block;\n            width:188px;\n            height:64px;\n            border:1px solid #D7D7D7;\n            cursor:pointer;\n            &:last-child{\n              margin-left:20px;\n            }\n            &.checked{\n              border:1px solid #FF6700;\n            }\n          }\n          .pay-ali{\n            background:url('/imgs/pay/icon-ali.png') no-repeat center;\n            background-size:103px 38px;\n            margin-top:19px;\n          }\n          .pay-wechat{\n            background:url('/imgs/pay/icon-wechat.png') no-repeat center;\n            background-size:103px 38px;\n          }\n        }\n      }\n    }\n  }\n</style>"]}]}